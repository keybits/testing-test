machine:
  pre:
    - cat ~/.ssh/authorized_keys
  python:
    version: 3.5.2
#  php:
#    version: 7.0.4
#  node:
#    version: 6.1.0
#  ruby:
#    version: 2.3.1
#    - redis
  environment:
    SHORT_GIT_HASH: $(echo $CIRCLE_SHA1 | cut -c -7)


dependencies:
  pre:
    - cd ~ && wget http://www.memcached.org/files/memcached-1.4.31.tar.gz && tar -zxvf memcached-1.4.31.tar.gz
    - sudo apt-get install libevent-dev
    - cd ~/memcached-1.4.31 && make && sudo make install
    - sudo rm /usr/bin/memcached && sudo  ln -s /usr/local/memcached/bin/memcached /usr/bin/memcached
    - sudo memcached -u root -d -m 1024 -p 11211 -l localhost
    - echo "stats" | nc localhost 11211

test:
  override:
    - case $CIRCLE_NODE_INDEX in 0) nosetests tests/test1.py ;; 1) nosetests tests/test2.py ;; esac:
        parallel: true
  post:
    - echo $CIRCLE_NODE_INDEX:
        parallel: true
    - set |grep CIRCLE
    - touch $CIRCLE_ARTIFACTS/file.txt
    - echo $SHORT_GIT_HASH

deployment:
  production:
    tag: /.*/
    commands:
      - "true"
